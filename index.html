<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alpha Score Rolling Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;500;600;700;800&display=swap"
      rel="stylesheet" />
    <!-- Lucid Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      :root {
        /* Light Mode Palette */
        --bg-light: #ffffff; /* Updated background to white */
        --text-light: #000000;
        --card-bg-light: #ffffff;
        --border-color: #000000;
        --shadow-color: #000000;
        --button-primary-bg-light: #2563eb;
        --button-primary-text-light: #ffffff;
        --button-primary-hover-bg-light: #1d4ed8;
        --button-toggle-bg-light: #ffffff;
        --button-toggle-text-light: #000000;
        --button-toggle-icon-light: #000000;
        --summary-card-bg-light: #facc15;
        --summary-card-text-light: #000000;
        --table-header-bg-light: #34d399;
        --table-header-text-light: #000000;
        --table-even-row-bg-light: #f3f4f6;
        --table-odd-row-bg-light: #ffffff;
        --table-data-text-light: var(--text-light);
        --error-text-light: #9f1239;
        --error-bg-light: #fecdd3;
        --grid-line-color-light: rgba(229,231,235,0.8); /* From user request */
        --disclaimer-text-light: #4b5563;
        --guide-list-marker-light: #2563eb; /* blue-600 for list markers */
        --calc-result-strong-light: #1d4ed8; /* blue-700 */
        --bnb-bonus-text-light: #059669; /* green-600 */
        --card-header-hover-bg-light: #f3f4f6; /* For card header hover */
        --input-readonly-bg-light: #e5e7eb; /* gray-200 */

        /* Dark Mode Palette */
        --bg-dark: #111827;
        --text-dark: #f3f4f6;
        --card-bg-dark: #1f2937;
        --button-primary-bg-dark: #2563eb;
        --button-primary-text-dark: #ffffff;
        --button-primary-hover-bg-dark: #1d4ed8;
        --button-toggle-bg-dark: #374151;
        --button-toggle-text-dark: #f3f4f6;
        --button-toggle-icon-dark: #ffffff;
        --summary-card-bg-dark: #facc15;
        --summary-card-text-dark: var(--text-dark); /* Changed from #000000 */
        --table-header-bg-dark: #34d399;
        --table-header-text-dark: #000000;
        --table-even-row-bg-dark: #374151;
        --table-odd-row-bg-dark: #1f2937;
        --table-data-text-dark: #ffffff;
        --error-text-dark: #9f1239;
        --error-bg-dark: #fecdd3;
        --grid-line-color-dark: rgba(255, 255, 255, 0.05);
        --disclaimer-text-dark: #9ca3af;
        --guide-list-marker-dark: #60a5fa; /* blue-400 for list markers */
        --calc-result-strong-dark: #60a5fa; /* blue-400 */
        --bnb-bonus-text-dark: #34d399; /* green-400 */
        --card-header-hover-bg-dark: #374151; /* For card header hover */
        --input-readonly-bg-dark: #374151; /* gray-700 for dark mode */
      }

      html,
      body {
        height: 100%;
      }

      body {
        font-family: "Poppins", "Kantumruy Pro", sans-serif;
        background-color: var(--bg-light);
        color: var(--text-light);
        transition: background-color 0.3s, color 0.3s;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background-image: linear-gradient(to right, var(--grid-line-color-light) 1px, transparent 1px),
                          linear-gradient(to bottom, var(--grid-line-color-light) 1px, transparent 1px),
                          radial-gradient(circle 500px at 20% 80%, rgba(139,92,246,0.3), transparent),
                          radial-gradient(circle 500px at 80% 20%, rgba(59,130,246,0.3), transparent);
        background-size: 48px 48px, 48px 48px, 100% 100%, 100% 100%;
        background-attachment: fixed;
      }
      body.dark-mode {
        background-color: var(--bg-dark);
        color: var(--text-dark);
        background-image: linear-gradient(to right, var(--grid-line-color-dark) 1px, transparent 1px),
                          linear-gradient(to bottom, var(--grid-line-color-dark) 1px, transparent 1px),
                          radial-gradient(circle 500px at 20% 80%, rgba(139,92,246,0.3), transparent),
                          radial-gradient(circle 500px at 80% 20%, rgba(59,130,246,0.3), transparent);
        background-size: 48px 48px, 48px 48px, 100% 100%, 100% 100%;
        background-attachment: fixed;
      }
      .main-container {
        width: 100%;
        max-width: 1280px;
        margin-left: auto;
        margin-right: auto;
        padding-left: 1rem;
        padding-right: 1rem;
        flex-grow: 1;
        padding-bottom: 2rem;
        padding-top: 1.5rem;
      }
      @media (min-width: 640px) {
        .main-container {
          padding-left: 1.5rem;
          padding-right: 1.5rem;
        }
      }
      @media (min-width: 1024px) {
        .main-container {
          padding-left: 2rem;
          padding-right: 2rem;
        }
      }

      @keyframes border-shine {
        0% { background-position: 0% 0%; }
        100% { background-position: 100% 0%; }
      }
      
      .top-shine-bar {
        position: fixed;
        height: 4px;
        top: 0px;
        left: 0;
        width: 100%;
        background: linear-gradient(to right, rgb(67, 215, 100) 0%, rgb(255, 183, 44) 12%, rgb(255, 93, 0) 22%, rgb(236, 10, 10) 33%, rgb(180, 5, 183) 44%, rgb(128, 0, 255) 55%, rgb(40, 92, 255) 66%, rgb(67, 215, 100) 77%, rgb(255, 183, 44) 88%, rgb(255, 93, 0) 100%) 0% 0% / 300%;
        animation: 2s linear 0s infinite alternate none running border-shine;
        z-index: 9999;
      }

      .neobrutalist-card {
        background-color: var(--card-bg-light);
        border: 3px solid var(--border-color);
        border-radius: 0.5rem;
        box-shadow: 6px 6px 0px var(--shadow-color);
        padding: 0; /* Padding will be handled by header and content */
        margin-bottom: 1rem;
        transition: background-color 0.3s;
      }
      body.dark-mode .neobrutalist-card {
        background-color: var(--card-bg-dark);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem; /* Tailwind p-3 equivalent for header */
        cursor: pointer;
        border-bottom: 2px solid transparent; /* For spacing, or actual border if content shown */
        transition: background-color 0.2s;
      }
      .neobrutalist-card:hover .card-header {
        /* Subtle hover for header */
        background-color: var(--card-header-hover-bg-light);
      }
      body.dark-mode .neobrutalist-card:hover .card-header {
        background-color: var(--card-header-hover-bg-dark);
      }
      .card-header h1,
      .card-header h2 {
        margin-bottom: 0 !important; /* Override existing margin for page-title/other titles */
      }

      .card-content {
        padding: 1rem; /* Inner padding for card content */
        border-top: 2px solid var(--grid-line-color-light); /* Separator line */
        transition: padding 0.3s ease-in-out, max-height 0.3s ease-in-out;
      }
      body.dark-mode .card-content {
        border-top-color: var(--grid-line-color-dark);
      }
      .card-content.hidden {
        display: none;
      }

      .input-label {
        display: block;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        font-weight: 700;
        color: var(--text-light);
        transition: color 0.3s;
      }
      body.dark-mode .input-label {
        color: var(--text-dark);
      }

      .input-field {
        width: 100%;
        padding: 0.75rem;
        border: 3px solid var(--border-color);
        border-radius: 0.375rem;
        font-size: 1rem;
        background-color: var(--card-bg-light);
        font-weight: 500;
        color: var(--text-light);
        transition: transform 0.1s ease-out, box-shadow 0.1s ease-out,
          background-color 0.3s, color 0.3s;
      }
      body.dark-mode .input-field {
        background-color: var(--bg-dark);
        color: var(--text-dark);
      }
      .input-field:focus {
        outline: none;
        box-shadow: 3px 3px 0px var(--shadow-color);
        transform: translate(-1px, -1px);
      }
      .input-field[readonly] {
        background-color: var(--input-readonly-bg-light);
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }
      body.dark-mode .input-field[readonly] {
        background-color: var(--input-readonly-bg-dark);
      }

      .toggle-button {
        background-color: var(--button-toggle-bg-light);
        color: var(--button-toggle-text-light);
        font-weight: 700;
        height: 44px;
        padding: 0 0.75rem;
        border-radius: 0.375rem;
        border: 3px solid var(--border-color);
        box-shadow: 3px 3px 0px var(--shadow-color);
        transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, background-color 0.3s, color 0.3s;
        cursor: pointer;
        margin-left: 0.5rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        gap: 0.35rem;
      }
      
      .toggle-button.icon-only {
        width: 44px;
        padding: 0;
      }

      body.dark-mode .toggle-button {
        background-color: var(--button-toggle-bg-dark);
        color: var(--button-toggle-text-dark);
      }
      .toggle-button .lucide,
      .card-toggle-button .lucide {
        width: 24px;
        height: 24px;
        stroke: var(--button-toggle-icon-light);
        fill: none !important;
        transition: stroke 0.3s, transform 0.3s;
      }
      .toggle-button .binance-logo {
        width: 24px;
        height: 24px;
      }
      body.dark-mode .toggle-button .lucide,
      body.dark-mode .card-toggle-button .lucide {
        stroke: var(--button-toggle-icon-dark);
      }
      .card-toggle-button .lucide.rotate-180 {
        /* For chevron pointing up */
        transform: rotate(180deg);
      }

      #twitterButton svg path {
        fill: var(--button-toggle-icon-light);
        transition: fill 0.3s;
      }
      body.dark-mode #twitterButton svg path {
        fill: var(--button-toggle-icon-dark);
      }
      .toggle-button span {
        font-size: 0.75rem;
        line-height: 1.5;
        color: var(--button-toggle-text-light);
        transition: color 0.3s;
      }
      body.dark-mode .toggle-button span {
        color: var(--button-toggle-text-dark);
      }
      #twitterButton span {
        margin-left: 0.25rem;
      }

      .toggle-button:hover {
        transform: translate(-1px, -1px);
        box-shadow: 4px 4px 0px var(--shadow-color);
      }

      .simulate-button {
        /* Also used for Calculate Trades button */
        width: 100%;
        background-color: var(--button-primary-bg-light);
        color: var(--button-primary-text-light);
        font-weight: 800;
        padding: 0.875rem 0;
        border-radius: 0.375rem;
        border: 3px solid var(--border-color);
        font-size: 1.125rem;
        box-shadow: 4px 4px 0px var(--shadow-color);
        transition: transform 0.1s ease-out, box-shadow 0.1s ease-out,
          background-color 0.3s, color 0.3s;
        cursor: pointer;
      }
      body.dark-mode .simulate-button {
        background-color: var(--button-primary-bg-dark);
        color: var(--button-primary-text-dark);
      }
      .simulate-button:hover {
        background-color: var(--button-primary-hover-bg-light);
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0px var(--shadow-color);
      }
      body.dark-mode .simulate-button:hover {
        background-color: var(--button-primary-hover-bg-dark);
      }
      .simulate-button:active {
        transform: translate(2px, 2px);
        box-shadow: 2px 2px 0px var(--shadow-color);
      }

      .summary-card {
        /* This is a specific card, will apply general neobrutalist-card and then specific header/content */
        /* background-color already handled by neobrutalist-card and specific vars */
      }
      body.dark-mode .summary-card {
        /* background-color already handled by neobrutalist-card and specific vars */
      }
      .summary-text {
        /* This is the content of summary card */
        font-size: 1.125rem;
        font-weight: 700;
        text-align: center;
        color: var(
          --summary-card-text-light
        ); /* Ensure text color is applied */
      }
      body.dark-mode .summary-text {
        color: var(--summary-card-text-dark);
      }

      .results-table {
        width: 100%;
        /* margin-top: 1rem;  This margin will be part of card-content padding */
        border-collapse: collapse;
        font-size: 0.875rem;
        border: 3px solid var(--border-color);
      }
      .results-table th,
      .results-table td {
        border: 2px solid var(--border-color);
        padding: 0.5rem;
        text-align: left;
        transition: background-color 0.3s, color 0.3s;
      }
      .results-table th {
        background-color: var(--table-header-bg-light);
        color: var(--table-header-text-light);
        font-weight: 700;
        border-bottom-width: 3px;
      }
      body.dark-mode .results-table th {
        background-color: var(--table-header-bg-dark);
        color: var(--table-header-text-dark);
      }
      .results-table td {
        color: var(--table-data-text-light);
      }
      body.dark-mode .results-table td {
        color: var(--table-data-text-dark);
      }
      .results-table td.text-center {
        text-align: center;
      }
      .results-table tr:nth-child(even) td {
        background-color: var(--table-even-row-bg-light);
      }
      body.dark-mode .results-table tr:nth-child(even) td {
        background-color: var(--table-even-row-bg-dark);
      }
      .results-table tr:nth-child(odd) td {
        background-color: var(--table-odd-row-bg-light);
      }
      body.dark-mode .results-table tr:nth-child(odd) td {
        background-color: var(--table-odd-row-bg-dark);
      }

      .error-message-style {
        color: var(--error-text-light);
        background-color: var(--error-bg-light);
        border: 3px solid var(--border-color);
        padding: 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        text-align: center;
        font-weight: 600;
        box-shadow: 4px 4px 0px var(--shadow-color);
        transition: background-color 0.3s, color 0.3s;
      }
      body.dark-mode .error-message-style {
        color: var(--error-text-dark);
        background-color: var(--error-bg-dark);
      }

      .page-title {
        /* Used in Alpha Sim Card Header */
        font-size: 1.75rem;
        font-weight: 800;
        text-align: center;
        /* margin-bottom: 1.5rem; Removed, header handles spacing */
        color: var(--text-light);
        transition: color 0.3s;
      }
      body.dark-mode .page-title {
        color: var(--text-dark);
      }
      .controls-container {
        display: flex;
        justify-content: flex-end; /* UPDATED */
        align-items: center;
        margin-bottom: 1rem;
        flex-wrap: nowrap; /* UPDATED */
      }
      #alphaScoreSimulatorCard .card-header h1, /* Targeting specific h1 */
      #resultsCard .card-header h2, 
      #guideCard .card-header h2, 
      #volumeCalcCard .card-header h2,
      #alphaVolumeCard .card-header h1,
      #summaryCard .card-header h2 {
        /* Targeting title in summary card header */
        color: var(--text-light);
        transition: color 0.3s;
        flex-grow: 1; /* Allow title to take space */
      }
      body.dark-mode #alphaScoreSimulatorCard .card-header h1,
      body.dark-mode #resultsCard .card-header h2,
      body.dark-mode #guideCard .card-header h2,
      body.dark-mode #volumeCalcCard .card-header h2,
      body.dark-mode #alphaVolumeCard .card-header h1,
      body.dark-mode #summaryCard .card-header h2 {
        color: var(--text-dark);
      }

      .disclaimer-text {
        font-size: 0.75rem;
        text-align: center;
        margin-top: 1.5rem;
        padding: 0.5rem;
        color: var(--disclaimer-text-light);
        transition: color 0.3s;
      }
      body.dark-mode .disclaimer-text {
        color: var(--disclaimer-text-dark);
      }

      /* Guide Card Styles */
      #guideCard ul {
        list-style-type: none;
        padding-left: 0;
      }
      #guideCard li {
        position: relative;
        padding-left: 1.75rem;
        margin-bottom: 0.75rem;
        font-size: 0.875rem;
        line-height: 1.6;
      }
      #guideCard li::before {
        content: "→";
        position: absolute;
        left: 0;
        top: 0;
        font-weight: bold;
        color: var(--guide-list-marker-light);
        transition: color 0.3s;
      }
      body.dark-mode #guideCard li::before {
        color: var(--guide-list-marker-dark);
      }
      #guideCard strong {
        font-weight: 700;
        color: var(--button-primary-bg-light);
      }
      body.dark-mode #guideCard strong {
        color: #93c5fd;
      }
      
      /* START: Animated Checkbox Styles */
      .toggle-container {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem; /* Spacing between checkboxes */
        justify-content: flex-start;
        padding-left: 0.25rem;
      }
      .toggle-container input[type="checkbox"] {
        /* Hide the default checkbox */
        opacity: 0;
        position: absolute;
        width: 1.25em;
        height: 1.25em;
      }
      .toggle-container label {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-light);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        transition: transform 0.1s ease-out;
      }
      body.dark-mode .toggle-container label {
        color: var(--text-dark);
      }
       .toggle-container label:active {
        transform: scale(0.95);
      }
      .custom-checkbox-box {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 1.25em;
        height: 1.25em;
        border: 2px solid var(--border-color);
        border-radius: 0.125rem;
        transition: background-color 0.3s, border-color 0.3s;
      }
      .custom-checkbox-box svg {
        width: 0.85em;
        height: 0.85em;
        stroke: var(--button-primary-text-light);
        stroke-width: 3.5;
      }
      body.dark-mode .custom-checkbox-box svg {
        stroke: var(--button-primary-text-dark);
      }
      .custom-checkbox-box svg path {
        stroke-dasharray: 100;
        stroke-dashoffset: 100;
        transition: stroke-dashoffset 0.4s 0.1s ease-out;
      }
      .toggle-container input[type="checkbox"]:checked + label .custom-checkbox-box {
        background-color: var(--button-primary-bg-light);
        border-color: var(--button-primary-bg-light);
      }
      body.dark-mode .toggle-container input[type="checkbox"]:checked + label .custom-checkbox-box {
        background-color: var(--button-primary-bg-dark);
        border-color: var(--button-primary-bg-dark);
      }
      .toggle-container input[type="checkbox"]:checked + label .custom-checkbox-box svg path {
        stroke-dashoffset: 0;
      }
      /* END: Animated Checkbox Styles */


      #volumeCalcResults {
        margin-top: 1.5rem; /* Tailwind mt-6 */
      }
      .calc-result-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0; /* Tailwind py-2 */
        border-bottom: 1px dashed var(--grid-line-color-light);
        font-size: 0.875rem; /* Standardized font size for results */
      }
      body.dark-mode .calc-result-item {
        border-bottom-color: var(--grid-line-color-dark);
      }
      .calc-result-item:last-child {
        border-bottom: none;
      }
      .calc-result-label {
        font-weight: 500; /* Tailwind font-medium */
        color: var(--text-light);
        margin-right: 0.5rem;
        flex-shrink: 0; /* Prevent label from shrinking too much */
      }
      body.dark-mode .calc-result-label {
        color: var(--text-dark);
      }
      .calc-result-value {
        font-weight: 600; /* Tailwind font-semibold */
        color: var(--calc-result-strong-light); /* Make all values stand out */
        text-align: right; /* Align value to the right */
      }
      body.dark-mode .calc-result-value {
        color: var(--calc-result-strong-dark);
      }
      .calc-result-value strong {
        color: var(
          --calc-result-strong-light
        ); /* Ensure strong tag uses the same color */
      }
      body.dark-mode .calc-result-value strong {
        color: var(--calc-result-strong-dark);
      }

      /* Specific styling for "Approx. Trades Needed" to make it larger */
      .calc-result-item.trades-needed-item .calc-result-label,
      .calc-result-item.trades-needed-item .calc-result-value {
        font-size: 1.125rem; /* text-lg */
      }
      .calc-result-item.trades-needed-item .calc-result-value strong {
        font-size: 1.5rem; /* text-2xl */
      }

      #otherChainBonusResultItem .bnb-bonus-text, #bscBonusResultItem .bnb-bonus-text {
        color: var(--bnb-bonus-text-light) !important;
      }
      body.dark-mode #otherChainBonusResultItem .bnb-bonus-text, body.dark-mode #bscBonusResultItem .bnb-bonus-text {
        color: var(--bnb-bonus-text-dark) !important;
      }
      #otherChainBonusResultItem strong, #bscBonusResultItem strong {
        color: var(--bnb-bonus-text-light) !important;
      }
      body.dark-mode #otherChainBonusResultItem strong, body.dark-mode #bscBonusResultItem strong {
        color: var(--bnb-bonus-text-dark) !important;
      }

      /* START: Highlight Text Animation Styles */
      @keyframes highlight-bg-animation {
        0% {
          background-size: 0% 100%;
        }
        100% {
          background-size: 100% 100%;
        }
      }
      .highlight-text-nav {
        position: relative;
        display: inline-block;
        font-size: 1.5rem;
        font-weight: 700;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        color: var(--text-light);
        /* UPDATED: Binance yellow gradient */
        background-image: linear-gradient(to right, #F0B90B, #F8D33A); 
        background-repeat: no-repeat;
        background-position: left center;
        animation: highlight-bg-animation 1.5s ease-out forwards;
        background-size: 0% 100%;
      }
      body.dark-mode .highlight-text-nav {
        color: #000; /* Black text on yellow looks better in dark mode too */
        background-image: linear-gradient(to right, #F0B90B, #F8D33A);
      }
       /* END: Highlight Text Animation Styles */

      /* START: Trades Needed Value Style */
      .trades-needed-highlight {
          color: var(--bnb-bonus-text-light) !important;
          font-weight: 800 !important;
      }
      body.dark-mode .trades-needed-highlight {
          color: var(--bnb-bonus-text-dark) !important;
      }
      /* END: Trades Needed Value Style */

      /* START: Alpha Volume Card Styles */
       @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      .spinning {
        animation: spin 1s linear infinite;
      }

      #alphaVolumeCard .last-up{ text-align:left;font-size:.8rem;color:var(--disclaimer-text-light);margin-bottom:12px }
      body.dark-mode #alphaVolumeCard .last-up { color: var(--disclaimer-text-dark); }

      #alphaVolumeCard #bar{
        display:flex;flex-wrap:wrap;align-items:center;gap:8px;
        padding: 0; margin-bottom: 1rem;
      }
      #alphaVolumeCard #bar-left{flex:1;display:flex;flex-wrap:wrap;align-items:center;gap:8px}
      #alphaVolumeCard #bar-left input { flex:1;min-width:160px }
      #alphaVolumeCard #bar-left input[type="text"]{width:120px}
      #alphaVolumeCard #bar-left input[type="datetime-local"]{width:190px}
      #alphaVolumeCard #bar-left input, #alphaVolumeCard #rangeBtn, #alphaVolumeCard #refreshBtn {
        padding: 0.5rem;
        border: 2px solid var(--border-color);
        border-radius: 0.375rem;
        font-size: 0.875rem;
        background-color: var(--card-bg-light);
        font-weight: 500;
        color: var(--text-light);
        transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, background-color 0.3s, color 0.3s;
      }
       #alphaVolumeCard #bar-left input:focus {
        outline: none;
        box-shadow: 3px 3px 0px var(--shadow-color);
        transform: translate(-1px, -1px);
      }
      body.dark-mode #alphaVolumeCard #bar-left input {
        background-color: var(--bg-dark);
        color: var(--text-dark);
      }
       #alphaVolumeCard #rangeBtn, #alphaVolumeCard #refreshBtn {
         background-color: var(--button-primary-bg-light);
         color: var(--button-primary-text-light);
         cursor: pointer;
         font-weight: 600;
         display: inline-flex;
         align-items: center;
         gap: 0.35rem;
       }
       body.dark-mode #alphaVolumeCard #rangeBtn, body.dark-mode #alphaVolumeCard #refreshBtn {
         background-color: var(--button-primary-bg-dark);
         color: var(--button-primary-text-dark);
       }
       #alphaVolumeCard #refreshBtn:not([disabled]):hover {
        background-color: var(--button-primary-hover-bg-light);
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0px var(--shadow-color);
      }
      body.dark-mode #alphaVolumeCard #refreshBtn:not([disabled]):hover {
          background-color: var(--button-primary-hover-bg-dark);
      }
      #alphaVolumeCard #refreshBtn:not([disabled]):active {
          transform: translate(1px, 1px);
          box-shadow: 1px 1px 0px var(--shadow-color);
      }
        #alphaVolumeCard .btn[disabled]{background:#9ca3af;border-color:#9ca3af;cursor:not-allowed}
      #alphaVolumeCard .badge{
        display:none;padding:0 6px;border-radius:10px;font-size:.7rem;font-weight:700;
        background:#fff;color:var(--button-primary-bg-light);
      }
      
      #alphaVolumeCard #tokenTable{ width:100%; border-collapse:collapse;min-width:600px; overflow-x: auto; }
      #alphaVolumeCard th,#alphaVolumeCard td{
        padding:10px 6px;border-bottom:1px solid var(--grid-line-color-light);
        font-size:.85rem;text-align:left;white-space:nowrap
      }
      body.dark-mode #alphaVolumeCard th, body.dark-mode #alphaVolumeCard td { border-bottom-color: var(--grid-line-color-dark); }
      #alphaVolumeCard tbody tr:hover{background:rgba(0,0,0,.04);cursor:pointer}
      body.dark-mode #alphaVolumeCard tbody tr:hover{ background: rgba(255,255,255,0.04); }
      #alphaVolumeCard th { font-weight: 700; }
      #alphaVolumeCard th.sortable{cursor:pointer;user-select:none;position:relative}
      #alphaVolumeCard th.sortable::after{
        content:'▲';position:absolute;right:4px;font-size:.6rem;color: var(--text-light);
        transform:scale(.8);opacity:0;transition:opacity .2s
      }
      body.dark-mode #alphaVolumeCard th.sortable::after { color: var(--text-dark); }
      #alphaVolumeCard th.sortable.desc::after{content:'▼';opacity:1}
      #alphaVolumeCard th.sortable.asc::after{content:'▲';opacity:1}
      #alphaVolumeCard .star{cursor:pointer;font-size:1rem;color:var(--disclaimer-text-light);user-select:none;transition:transform .15s,color .15s}
      #alphaVolumeCard .star.fav{color:#f7b500}.star.bounce{transform:scale(1.4)}
      #alphaVolumeCard .logo{width:18px;height:18px;margin-right:4px;vertical-align:middle;border-radius:50%}
      #alphaVolumeCard .up{color:#16a34a}
      #alphaVolumeCard .down{color:#dc2626}
      #alphaVolumeCard .subl{display:block;font-size:.72rem;color:var(--disclaimer-text-light)}
      body.dark-mode #alphaVolumeCard .subl { color: var(--disclaimer-text-dark); }
      
      .new-token-icon {
          display: inline-block;
          width: 16px;
          height: 16px;
          vertical-align: middle;
          margin-left: 6px;
          color: var(--summary-card-bg-light); /* Yellow */
      }
       .bsc-icon-bonus {
          display: inline-block;
          width: 16px;
          height: 16px;
          vertical-align: middle;
          margin: 0 4px;
          color: var(--summary-card-bg-light); /* Yellow */
      }
      body.dark-mode .new-token-icon, body.dark-mode .bsc-icon-bonus {
          color: var(--summary-card-bg-dark); /* Same yellow */
      }

      #toast{
        position:fixed;bottom:40px;left:50%;transform:translateX(-50%);
        background:rgba(0,0,0,.8);color:#fff;padding:8px 16px;border-radius:6px;
        font-size:.85rem;opacity:0;pointer-events:none;transition:opacity .3s; z-index: 10000;
      }
      #customVol{ margin: 1rem 0;font-size:.9rem;color:var(--button-primary-bg-light)}
      body.dark-mode #customVol { color: #93c5fd; }
       p.bonus-remark {
        font-size: 0.75rem;
        color: var(--bnb-bonus-text-light);
        padding-left: 0.25rem;
        margin-top: 0.25rem;
        margin-bottom: 0.75rem;
        font-weight: 500;
      }
      body.dark-mode p.bonus-remark {
        color: var(--bnb-bonus-text-dark);
      }
      .bonus-button {
        padding: 0.75rem 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        text-align: center;
        background-color: var(--card-bg-light);
        color: var(--text-light);
        border: none;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        border-right: 2px solid var(--border-color);
      }
      .bonus-button:last-child {
          border-right: none;
      }
      .bonus-button.active {
          background-color: var(--button-primary-bg-light);
          color: var(--button-primary-text-light);
      }
      body.dark-mode .bonus-button {
          background-color: var(--card-bg-dark);
          color: var(--text-dark);
          border-right-color: var(--border-color);
      }
      body.dark-mode .bonus-button.active {
          background-color: var(--button-primary-bg-dark);
          color: var(--button-primary-text-dark);
      }
      /* END: Alpha Volume Card Styles */


      @media (max-width: 760px){
        #alphaVolumeCard #bar-left input[type="datetime-local"]{flex:1;min-width:140px}
      }

      @media (max-width: 640px) {
        /* sm breakpoint */
        .controls-container {
          flex-direction: row; /* Keep as row */
          justify-content: flex-end; /* Align to the right */
        }
        .toggle-button {
          margin-top: 0;
        }
        .page-title {
          font-size: 1.5rem;
        }
        .results-table th,
        .results-table td {
          padding: 0.3rem;
          font-size: 0.75rem;
        }
       
        .slippage-badge,
        .wallet-badge {
          font-size: 0.75rem;
          padding: 0.25rem 0.5rem;
        }
        #guideCard li {
          font-size: 0.8rem;
        }
       
        .toggle-container {
          flex-direction: column;
          align-items: flex-start;
          justify-content: flex-start; /* Align to left on small screens */
        }
        .toggle-container input[type="checkbox"] {
          margin-bottom: 0.25rem;
        }
        .calc-result-item {
          flex-direction: column;
          align-items: flex-start;
        }
        .calc-result-value {
          margin-top: 0.125rem;
          text-align: left;
        }
        /* Adjust font sizes for calculator results on small screens */
        .calc-result-item.trades-needed-item .calc-result-label,
        .calc-result-item.trades-needed-item .calc-result-value {
          font-size: 1rem; /* text-base for smaller screens */
        }
        .calc-result-item.trades-needed-item .calc-result-value strong {
          font-size: 1.25rem; /* text-xl for smaller screens */
        }
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div class="top-shine-bar"></div>
    <div class="main-container">
      <div class="controls-container">
        <!-- Buttons are now on the right -->
        <div>
          <a
            href="https://accounts.binance.com/register?ref=380270089"
            target="_blank"
            rel="noopener noreferrer"
            id="binanceButton"
            class="toggle-button icon-only">
            <img class="binance-logo" src="https://images.icon-icons.com/3053/PNG/512/binance_macos_bigsur_icon_190342.png" alt="Binance Logo">
          </a>
          <a
            href="https://x.com/drv3v"
            target="_blank"
            rel="noopener noreferrer"
            id="twitterButton"
            class="toggle-button icon-only">
            <svg
              class="icon"
              style="width: 24px; height: 24px"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512">
              <path
                d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path>
            </svg>
          </a>
          <button id="languageToggleButton" class="toggle-button">
            <i data-lucide="languages" class="lucide icon"></i>
            <span data-translate="languageToggle">English</span>
          </button>
          <button id="darkModeToggle" class="toggle-button icon-only"></button>
        </div>
      </div>

      <!-- How to Use Card -->
      <div id="guideCard" class="neobrutalist-card">
        <div class="card-header" data-collapsible-target="guideContent">
          <h2 class="text-xl font-semibold" data-translate="guideTitle">
            How to Use This Simulator
          </h2>
          <button
            aria-label="Toggle guide content"
            aria-expanded="false"
            class="card-toggle-button p-1">
            <i data-lucide="chevron-down" class="card-toggle-icon w-6 h-6"></i>
          </button>
        </div>
        <div id="guideContent" class="card-content pt-4 hidden">
          <ul id="guideList">
            <li data-translate="guideStep1"></li>
            <li data-translate="guideStep7"></li>
            <li data-translate="guideStep5"></li>
            <li data-translate="guideStep6"></li>
          </ul>
        </div>
      </div>

      <!-- Volume Points Trade Calculator Card -->
      <div id="volumeCalcCard" class="neobrutalist-card">
        <div class="card-header" data-collapsible-target="volumeCalcContent">
          <h2 class="text-xl font-semibold" data-translate="volumeCalcTitle">
            Volume Points Trade Calculator
          </h2>
          <button
            aria-label="Toggle volume calculator content"
            aria-expanded="false"
            class="card-toggle-button p-1">
            <i data-lucide="chevron-down" class="card-toggle-icon w-6 h-6"></i>
          </button>
        </div>
        <div id="volumeCalcContent" class="card-content pt-4 hidden">
          <div id="volumeCalcErrorMessageContainer" class="mb-4"></div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-8 mb-2">
            <div>
              <label
                for="initialInvestmentVolCalc"
                class="input-label"
                data-translate="initialInvestmentVolCalcLabel"
                >Initial Investment (USD per trade)</label
              >
              <input
                type="number"
                id="initialInvestmentVolCalc"
                class="input-field"
                value="500"
                min="1" />
            </div>
            <div>
              <label
                for="targetVolumePointsCalc"
                class="input-label"
                data-translate="targetVolumePointsCalcLabel"
                >Target Volume Points</label
              >
              <input
                type="number"
                id="targetVolumePointsCalc"
                class="input-field"
                value="14"
                min="1" />
            </div>
          </div>
          <label class="input-label" data-translate="bonusSelectionLabel">Bonus Option</label>
          <div id="bonusOptions" class="flex w-full rounded-md border-2 border-[var(--border-color)] mb-2">
              <button class="bonus-button flex-1 rounded-l-sm active" data-multiplier="1" data-translate="notNewTokenToggleLabel"></button>
              <button class="bonus-button flex-1" data-multiplier="2" data-translate="otherChainToggleLabel"></button>
              <button class="bonus-button flex-1 rounded-r-sm" data-multiplier="4" data-translate="bscChainToggleLabel" class="inline-flex items-center"></button>
          </div>
           <p class="bonus-remark" data-translate="bonusRemark"></p>

          <button
            id="calculateTradesButton"
            class="simulate-button mt-4"
            data-translate="calculateTradesButtonLabel">
            Calculate Trades
          </button>

          <div
            id="volumeCalcResults"
            class="mt-6 space-y-3"
            style="display: none">
            <div class="calc-result-item">
              <span class="calc-result-label" data-translate="volCalcMsg1"
                >Target:</span
              >
              <span class="calc-result-value"
                ><strong id="targetPointsDisplayV"></strong>
                <span data-translate="pointsUnit">points</span></span
              >
            </div>
            <div class="calc-result-item">
              <span class="calc-result-label" data-translate="volCalcMsg2"
                >Standard trade volume for points:</span
              >
              <span class="calc-result-value"
                >$<strong id="standardVolumeDisplayV"></strong
              ></span>
            </div>
            <div
              id="otherChainBonusResultItem"
              class="calc-result-item"
              style="display: none">
              <span
                class="calc-result-label bnb-bonus-text"
                data-translate="otherChainBonusMsgLabel"
                >Other Chain Bonus - Effective Volume:</span
              >
              <span class="calc-result-value bnb-bonus-text"
                >$<strong id="effectiveOtherChainVolumeDisplayV"></strong
              ></span>
            </div>
            <div
              id="bscBonusResultItem"
              class="calc-result-item"
              style="display: none">
              <span
                class="calc-result-label bnb-bonus-text"
                data-translate="bscBonusMsgLabel"
                >BSC Bonus - Effective Volume:</span
              >
              <span class="calc-result-value bnb-bonus-text"
                >$<strong id="effectiveBscVolumeDisplayV"></strong
              ></span>
            </div>
            <div id="investmentResultItem" class="calc-result-item">
              <span class="calc-result-label" data-translate="volCalcMsg3"
                >Investment per Trade:</span
              >
              <span class="calc-result-value"
                >$<strong id="investmentPerTradeDisplayV"></strong
              ></span>
            </div>
            <div class="calc-result-item">
              <!-- Reordered: Total Actual Volume before Trades Needed -->
              <span class="calc-result-label" data-translate="volCalcMsg5"
                >Total Actual Volume:</span
              >
              <span class="calc-result-value"
                >$<strong id="totalAchievedVolumeDisplayV"></strong
              ></span>
            </div>
            <div class="calc-result-item trades-needed-item">
              <span class="calc-result-label" data-translate="volCalcMsg4"
                >Approx. Trades Needed:</span
              >
              <span id="tradesNeededResult" class="calc-result-value">
                <!-- Content injected by JS -->
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Alpha Score Rolling Simulator Card -->
      <div id="alphaScoreSimulatorCard" class="neobrutalist-card">
        <div class="card-header" data-collapsible-target="alphaScoreContent">
          <h1 class="page-title" data-translate="pageTitle">
            Alpha Score Rolling Simulator
          </h1>
          <button
            aria-label="Toggle alpha score simulator content"
            aria-expanded="true"
            class="card-toggle-button p-1">
            <i data-lucide="chevron-up" class="card-toggle-icon w-6 h-6"></i>
          </button>
        </div>
        <div id="alphaScoreContent" class="card-content pt-4">
          <div id="errorMessageContainer" class="mb-4"></div>

          <div
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-8 mb-8">
            <div>
              <label
                for="fixedDailyScore"
                class="input-label"
                data-translate="fixedDailyScoreLabel"
                >Fixed Daily Score</label
              >
              <input
                type="number"
                id="fixedDailyScore"
                class="input-field"
                value="16" />
            </div>
            <div>
              <label
                for="totalDays"
                class="input-label"
                data-translate="totalDaysLabel"
                >Total Days</label
              >
              <input
                type="number"
                id="totalDays"
                class="input-field"
                value="15"
                min="1" />
            </div>
            <div class="hidden">
              <label
                for="rollingWindow"
                class="input-label"
                data-translate="rollingWindowLabel"
                >Rolling Window (days)</label
              >
              <input
                type="number"
                id="rollingWindow"
                class="input-field"
                value="15"
                min="1"
                readonly />
            </div>
            <div>
              <label
                for="thresholdScore"
                class="input-label"
                data-translate="thresholdScoreLabel"
                >Threshold Score</label
              >
              <input
                type="number"
                id="thresholdScore"
                class="input-field"
                value="220" />
            </div>
            <div class="hidden">
              <label
                for="pointsConsumed"
                class="input-label"
                data-translate="pointsConsumedLabel"
                >Points Consumed per Claim</label
              >
              <input
                type="number"
                id="pointsConsumed"
                class="input-field"
                value="15"
                readonly />
            </div>
            <div>
              <label
                for="rewardPerClaim"
                class="input-label"
                data-translate="rewardPerClaimLabel"
                >Reward per Claim (USD)</label
              >
              <input
                type="number"
                id="rewardPerClaim"
                class="input-field"
                value="50" />
            </div>
          </div>

          <button
            id="simulateButton"
            class="simulate-button"
            data-translate="simulateButton">
            Simulate
          </button>
        </div>
      </div>

      <!-- Summary and Results card moved here -->
      <div id="summaryCard" class="neobrutalist-card hidden">
        <div class="card-header" data-collapsible-target="summaryContent">
          <h2 class="text-xl font-semibold" data-translate="summaryTitle">
            Simulation Summary
          </h2>
          <button
            aria-label="Toggle summary content"
            aria-expanded="true"
            class="card-toggle-button p-1">
            <i data-lucide="chevron-up" class="card-toggle-icon w-6 h-6"></i>
          </button>
        </div>
        <div id="summaryContent" class="card-content pt-4">
          <p id="summaryText" class="summary-text"></p>
        </div>
      </div>

      <div id="resultsCard" class="neobrutalist-card hidden">
        <div class="card-header" data-collapsible-target="resultsContent">
          <h2 class="text-xl font-semibold" data-translate="resultsTitle">
            Simulation Details
          </h2>
          <button
            aria-label="Toggle results content"
            aria-expanded="true"
            class="card-toggle-button p-1">
            <i data-lucide="chevron-up" class="card-toggle-icon w-6 h-6"></i>
          </button>
        </div>
        <div id="resultsContent" class="card-content pt-4">
          <div class="overflow-x-auto">
            <table class="results-table">
              <thead>
                <tr>
                  <th data-translate="tableDay">Day</th>
                  <th data-translate="tableDailyScore">Score</th>
                  <th data-translate="tableTotalInWindow">Total</th>
                  <th data-translate="tableClaimed">Claimed?</th>
                  <th data-translate="tablePtsConsumed">Pts Used</th>
                  <th data-translate="tableRewardToday">Reward (USD)</th>
                  <th data-translate="tableWindowRange">Window</th>
                </tr>
              </thead>
              <tbody id="resultsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Alpha Volume Card -->
      <div id="alphaVolumeCard" class="neobrutalist-card">
        <div class="card-header" data-collapsible-target="alphaVolumeContent">
          <h1 class="page-title" data-translate="alphaVolumeTitle" style="text-align: center; flex-grow: 1;">
            Alpha Volume
          </h1>
          <button
            aria-label="Toggle alpha volume content"
            aria-expanded="true"
            class="card-toggle-button p-1">
            <i data-lucide="chevron-up" class="card-toggle-icon w-6 h-6"></i>
          </button>
        </div>
        <div id="alphaVolumeContent" class="card-content pt-4">
          <div class="flex justify-between items-center mb-4">
            <p id="lastUp" class="last-up" style="margin-bottom: 0;"></p>
            <div class="toggle-container" style="margin-bottom: 0;">
                <input type="checkbox" id="onlyNew" checked />
                <label for="onlyNew">
                    <span class="custom-checkbox-box">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                    </span>
                    <span data-translate="onlyNewCheckbox"></span>
                </label>
            </div>
          </div>
          <div id="bar">
            <div id="bar-left">
              <input id="search" type="search" data-translate-placeholder="searchPlaceholder">
              <button id="refreshBtn" class="btn">
                  <i data-lucide="rotate-cw" id="refreshIcon" class="w-4 h-4"></i>
                  <span data-translate="refreshButton">Refresh Data</span>
                  <span id="progress" class="badge">0%</span>
              </button>
            </div>
          </div>
           <div id="customVol"></div>
           <div class="overflow-x-auto">
              <table id="tokenTable">
                <thead>
                  <tr>
                    <th style="width:26px"></th>
                    <th data-translate="tableHeaderRank"></th>
                    <th data-translate="tableHeaderToken"></th>
                    <th id="thPrice" data-translate="tableHeaderPrice"></th>
                    <th id="thVol24h" class="sortable" data-key="vol24h" data-translate="tableHeaderVol24h"></th>
                    <th data-translate="tableHeaderChange24h"></th>
                    <th id="thToday" class="sortable" data-key="todayQV" data-translate="tableHeaderTodayVol"></th>
                    <th id="thPrev" class="sortable" data-key="prevQV" data-translate="tableHeaderPrevVol"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="8" data-translate="loadingText"></td></tr>
                </tbody>
              </table>
            </div>
        </div>
      </div>

      <div id="disclaimerSection" class="disclaimer-text">
        <p data-translate="disclaimerText">
          Disclaimer: This simulator is for informational and entertainment
          purposes only and does not constitute financial advice.
        </p>
      </div>
    </div>
    <div id="toast"></div>

    <script>
      lucide.createIcons();

      const translations = {
        en: {
          languageToggle: "English",
          pageTitle: "Alpha Score Rolling Simulator",
          guideTitle: "How to Use This Simulator",
          guideStep1:
            "<strong>Alpha Sim:</strong> Enter daily score, total days, rolling window, threshold, points consumed, and reward to see claim projections.",
          guideStep5:
            "<strong>Note:</strong> This simulator is for informational and entertainment purposes only and does not constitute financial advice.",
          guideStep6: "",
          guideStep7: "<strong>Volume Calc:</strong> Input your investment per trade and target points. Select a bonus (2x for other chains or 4x for BSC) to see the required trades and total volume.",
          fixedDailyScoreLabel: "Fixed Daily Score",
          totalDaysLabel: "Total Days",
          rollingWindowLabel: "Rolling Window (days)",
          thresholdScoreLabel: "Threshold Score",
          pointsConsumedLabel: "Points Consumed per Claim",
          rewardPerClaimLabel: "Reward per Claim (USD)",
          simulateButton: "Simulate",
          summaryTitle: "Simulation Summary",
          resultsTitle: "Simulation Details",
          volumeCalcTitle: "Volume Points Trade Calculator",
          initialInvestmentVolCalcLabel: "Initial Investment (USD per trade)",
          targetVolumePointsCalcLabel: "Target Volume Points",
          calculateTradesButtonLabel: "Calculate Trades",
          otherChainToggleLabel: "Other Chain (2x)",
          bscChainToggleLabel: "BSC (4x)",
          notNewTokenToggleLabel: "Not New (1x)",
          bonusRemark: "Note: 2x and 4x bonuses only apply to tokens listed in the last 30 days.",
          bonusSelectionLabel: "Bonus Option",
          volCalcMsg1: "Target:",
          pointsUnit: "points",
          volCalcMsg2: "Standard trade volume for points:",
          otherChainBonusMsgLabel: "Other Chain Bonus - Effective Volume:",
          bscBonusMsgLabel: "BSC Bonus - Effective Volume:",
          volCalcMsg3: "Investment per Trade:",
          volCalcMsg4: "Approx. Trades Needed:",
          tradesUnit: "trades",
          volCalcMsg5: "Total Actual Volume:",
          errorInitialInvestment:
            "Initial Investment must be a positive number.",
          errorTargetVolumePoints:
            "Target Volume Points must be a positive number.",
          tableDay: "Day",
          tableDailyScore: "Score",
          tableTotalInWindow: "Total",
          tableClaimed: "Claimed?",
          tablePtsConsumed: "Pts Used",
          tableRewardToday: "Reward (USD)",
          tableWindowRange: "Window",
          errorNegativeScore: "Fixed Daily Score cannot be negative.",
          errorTotalDays: "Total Days must be greater than 0.",
          errorRollingWindow: "Rolling Window must be greater than 0.",
          errorWindowExceedsTotal: "Rolling Window cannot exceed Total Days.",
          errorThresholdScore: "Threshold Score must be greater than 0.",
          errorPointsConsumed: "Points Consumed per Claim cannot be negative.",
          errorRewardPerClaim: "Reward per Claim cannot be negative.",
          summaryClaimedText:
            "✅ Claimed {count} times, total reward {reward} USD",
          disclaimerText:
            "Disclaimer: This simulator is for informational and entertainment purposes only and does not constitute financial advice.",
          alphaVolumeTitle: "Alpha Volume Board",
          lastUpdated: "Last Updated: {time}",
          searchPlaceholder: "🔍 Filter by Token Name / Symbol…",
          refreshButton: "Refresh Data",
          onlyNewCheckbox: "Only show tokens listed in last 30 days",
          tableHeaderRank: "#",
          tableHeaderToken: "Token",
          tableHeaderPrice: "Price",
          tableHeaderVol24h: "24H Volume",
          tableHeaderChange24h: "24H Change",
          tableHeaderTodayVol: "Today's Limit Order Volume",
          tableHeaderPrevVol: "Prev. Day's Limit Order Volume",
          loadingText: "Loading…",
          loadFailedText: "Failed to load…",
          toastFavAdded: "Added to favorites",
          toastFavRemoved: "Removed from favorites",
          toastEnterSymbol: "Please enter a token symbol",
          toastTokenNotFound: "Token not found",
          toastInvalidTime: "Invalid time range",
        },
        km: {
          languageToggle: "ភាសាខ្មែរ",
          pageTitle: "កម្មវិធីគណនាពិន្ទុអាល់ហ្វា",
          guideTitle: "របៀបប្រើកម្មវិធីគណនានេះ",
          guideStep1:
            "<strong>កម្មវិធីគណនាពិន្ទុអាល់ហ្វា៖</strong> បញ្ចូលពិន្ទុប្រចាំថ្ងៃ, ចំនួនថ្ងៃ, រយៈពេលវិលជុំ, កម្រិតពិន្ទុ, ពិន្ទុប្រើប្រាស់, និងរង្វាន់ ដើម្បីមើលការព្យាករណ៍។",
          guideStep5:
            "<strong>កំណត់ចំណាំ៖</strong> កម្មវិធីគណនាធ្វើនេះគឺសម្រាប់គោលបំណងផ្តល់ព័ត៌មាន និងការកម្សាន្តតែប៉ុណ្ណោះ ហើយមិនមែនជាដំបូន្មានផ្នែកហិរញ្ញវត្ថុទេ។",
          guideStep6: "",
          guideStep7: "<strong>កម្មវិធីគណនាបរិមាណ៖</strong> បញ្ចូលការវិនិយោគរបស់អ្នកក្នុងមួយការជួញដូរ និងពិន្ទុគោលដៅ។ ជ្រើសរើសប្រាក់រង្វាន់ (2ដងសម្រាប់បណ្តាញផ្សេងទៀត ឬ 4ដងសម្រាប់ BSC) ដើម្បីមើលការជួញដូរដែលត្រូវការ និងបរិមាណសរុប។",
          fixedDailyScoreLabel: "ពិន្ទុថេរប្រចាំថ្ងៃ",
          totalDaysLabel: "ចំនួនថ្ងៃសរុប",
          rollingWindowLabel: "វិលត្រលប់ (ថ្ងៃ)",
          thresholdScoreLabel: "គោលដៅពិន្ទុ",
          pointsConsumedLabel: "ពិន្ទុប្រើប្រាស់ក្នុងការទទួលយកម្តង",
          rewardPerClaimLabel: "រង្វាន់ក្នុងមួយការទទួលយកម្តង (USD)",
          simulateButton: "គណនា",
          summaryTitle: "សេចក្ដីសង្ខេបនៃការគណនា",
          resultsTitle: "ព័ត៌មានលម្អិតនៃការគណនា",
          volumeCalcTitle: "កម្មវិធីគណនាពិន្ទុបរិមាណការជួញដូរ",
          initialInvestmentVolCalcLabel: "ការវិនិយោគ (USD ក្នុងការជួញដូរម្តង)",
          targetVolumePointsCalcLabel: "គោលដៅពិន្ទុបរិមាណ",
          calculateTradesButtonLabel: "គណនាការជួញដូរ",
          otherChainToggleLabel: "បណ្តាញផ្សេងទៀត (x2)",
          bscChainToggleLabel: "BSC (x4)",
          notNewTokenToggleLabel: "មិនថ្មី (x1)",
          bonusRemark: "ចំណាំ៖ ប្រាក់រង្វាន់ 2x និង 4x គឺសម្រាប់តែថូខឹនដែលបានចុះបញ្ជីក្នុងរយៈពេល 30 ថ្ងៃចុងក្រោយប៉ុណ្ណោះ។",
          bonusSelectionLabel: "ជម្រើសប្រាក់រង្វាន់",
          volCalcMsg1: "គោលដៅ៖",
          pointsUnit: "ពិន្ទុ",
          volCalcMsg2: "បរិមាណការជួញដូរស្ដង់ដារសម្រាប់ពិន្ទុនេះ៖",
          otherChainBonusMsgLabel: "ប្រាក់រង្វាន់បណ្តាញផ្សេងទៀត - បរិមាណមានប្រសិទ្ធភាព៖",
          bscBonusMsgLabel: "ប្រាក់រង្វាន់ BSC - បរិមាណមានប្រសិទ្ធភាព៖",
          volCalcMsg3: "ការវិនិយោគក្នុងមួយការជួញដូរម្តង៖",
          volCalcMsg4: "ចំនួនការជួញដូរដែលត្រូវការ (ប្រហាក់ប្រហែល)៖",
          tradesUnit: "ការជួញដូរ",
          volCalcMsg5: "បរិមាណជួញដូរសរុបជាក់ស្តែង៖",
          errorInitialInvestment: "ការវិនិយោគដំបូងត្រូវតែជាលេខវិជ្ជមាន។",
          errorTargetVolumePoints: "គោលដៅពិន្ទុបរិមាណត្រូវតែជាលេខវិជ្ជមាន។",
          tableDay: "ថ្ងៃទី",
          tableDailyScore: "ពិន្ទុ",
          tableTotalInWindow: "ពិន្ទុសរុប",
          tableClaimed: "ប្រហែលអាចទទួលបាន?",
          tablePtsConsumed: "ពិន្ទុបានប្រើ",
          tableRewardToday: "រង្វាន់ (USD)",
          tableWindowRange: "រយៈពេល",
          errorNegativeScore: "ពិន្ទុថេរប្រចាំថ្ងៃមិនអាចអវិជ្ជមានបានទេ។",
          errorTotalDays: "ចំនួនថ្ងៃសរុបត្រូវតែធំជាង 0។",
          errorRollingWindow: "វិលត្រលប់ (ថ្ងៃ)ត្រូវតែធំជាង 0។",
          errorWindowExceedsTotal:
            "វិលត្រលប់ (ថ្ងៃ)មិនអាចលើសពីจำนวนថ្ងៃសរុបបានទេ។",
          errorThresholdScore: "គោលដៅពិន្ទុត្រូវតែធំជាង 0។",
          errorPointsConsumed:
            "ពិន្ទុប្រើប្រាស់ក្នុងការទទួលយកម្តងមិនអាចអវិជ្ជមានបានទេ។",
          errorRewardPerClaim:
            "រង្វាន់ក្នុងមួយការទទួលយកម្តង (USD)មិនអាចអវិជ្ជមានបានទេ។",
          summaryClaimedText:
            "✅ ប្រហែលអាចទទួលបាន {count} ដង, រង្វាន់សរុប {reward} USD",
          disclaimerText:
            "ការបដិសេធ៖ កម្មវិធីគណនានេះគឺសម្រាប់គោលបំណងផ្តល់ព័ត៌មាន និងការកម្សាន្តតែប៉ុណ្ណោះ ហើយមិនមែនជាដំបូន្មានផ្នែកហិរញ្ញវត្ថុទេ។",
          alphaVolumeTitle: "តារាងបរិមាណអាល់ហ្វា",
          lastUpdated: "បានធ្វើបច្ចុប្បន្នភាពចុងក្រោយ៖ {time}",
          searchPlaceholder: "🔍 តម្រងតាមឈ្មោះ / និមិត្តសញ្ញា…",
          refreshButton: "ផ្ទុកទិន្នន័យឡើងវិញ",
          onlyNewCheckbox: "បង្ហាញតែថូខឹនដែលបានចុះក្នុងរយៈពេល 30 ថ្ងៃចុងក្រោយ",
          tableHeaderRank: "#",
          tableHeaderToken: "ថូខឹន",
          tableHeaderPrice: "តម្លៃ",
          tableHeaderVol24h: "បរិមាណ 24 ម៉ោង",
          tableHeaderChange24h: "ការផ្លាស់ប្តូរ 24 ម៉ោង",
          tableHeaderTodayVol: "បរិមាណថ្ងៃនេះ",
          tableHeaderPrevVol: "បរិមាណថ្ងៃមុន",
          loadingText: "កំពុង​ផ្ទុក…",
          loadFailedText: "ការផ្ទុកបានបរាជ័យ…",
          toastFavAdded: "បានបន្ថែមទៅចំណូលចិត្ត",
          toastFavRemoved: "បានដកចេញពីចំណូលចិត្ត",
          toastEnterSymbol: "សូមបញ្ចូលនិមិត្តសញ្ញាថូខឹន",
          toastTokenNotFound: "រកមិនឃើញថូខឹនទេ",
          toastInvalidTime: "ជួរពេលវេលាមិនត្រឹមត្រូវ",
        },
      };

      let currentLanguage = "km";
      let isDarkMode = false;

      // DOM Elements for Alpha Score Simulator
      const fixedDailyScoreEl = document.getElementById("fixedDailyScore");
      const totalDaysEl = document.getElementById("totalDays");
      const rollingWindowEl = document.getElementById("rollingWindow");
      const thresholdScoreEl = document.getElementById("thresholdScore");
      const pointsConsumedEl = document.getElementById("pointsConsumed");
      const rewardPerClaimEl = document.getElementById("rewardPerClaim");
      const simulateButtonEl = document.getElementById("simulateButton");

      const summaryCardEl = document.getElementById("summaryCard");
      const summaryTextEl = document.getElementById("summaryText");

      const resultsCardEl = document.getElementById("resultsCard");
      const resultsTableBodyEl = document.getElementById("resultsTableBody");
      const errorMessageContainerEl = document.getElementById(
        "errorMessageContainer"
      );
      const disclaimerSectionEl = document.getElementById("disclaimerSection");
      const guideCardEl = document.getElementById("guideCard");

      // DOM Elements for UI Controls
      const languageToggleButton = document.getElementById(
        "languageToggleButton"
      );
      const darkModeToggle = document.getElementById("darkModeToggle");
      const twitterButton = document.getElementById("twitterButton");
      const bodyEl = document.body;
      
      // DOM Elements for Volume Points Calculator
      const initialInvestmentVolCalcEl = document.getElementById(
        "initialInvestmentVolCalc"
      );
      const targetVolumePointsCalcEl = document.getElementById(
        "targetVolumePointsCalc"
      );
      const calculateTradesButtonEl = document.getElementById(
        "calculateTradesButton"
      );
      const volumeCalcResultsEl = document.getElementById("volumeCalcResults");
      const volumeCalcErrorMessageContainerEl = document.getElementById(
        "volumeCalcErrorMessageContainer"
      );
      const targetPointsDisplayVEl = document.getElementById(
        "targetPointsDisplayV"
      );
      const standardVolumeDisplayVEl = document.getElementById(
        "standardVolumeDisplayV"
      );
      const otherChainBonusResultItemEl = document.getElementById("otherChainBonusResultItem");
      const bscBonusResultItemEl = document.getElementById("bscBonusResultItem");

      const effectiveOtherChainVolumeDisplayVEl = document.getElementById("effectiveOtherChainVolumeDisplayV");
      const effectiveBscVolumeDisplayVEl = document.getElementById("effectiveBscVolumeDisplayV");
      const investmentPerTradeDisplayVEl = document.getElementById(
        "investmentPerTradeDisplayV"
      );
      const tradesNeededResultEl = document.getElementById("tradesNeededResult");
      const totalAchievedVolumeDisplayVEl = document.getElementById(
        "totalAchievedVolumeDisplayV"
      );

      // Function to handle card collapse/expand
      function toggleCardContent(buttonElement) {
        if (
          !buttonElement ||
          typeof buttonElement.setAttribute !== "function"
        ) {
          return;
        }
        const cardHeader = buttonElement.closest(".card-header");
        if (!cardHeader || !cardHeader.dataset.collapsibleTarget) {
          return;
        }

        const targetId = cardHeader.dataset.collapsibleTarget;
        const contentElement = document.getElementById(targetId);
        const iconElement = buttonElement.querySelector("i.card-toggle-icon");

        if (!contentElement) {
          return;
        }

        const isHidden = contentElement.classList.toggle("hidden");
        buttonElement.setAttribute("aria-expanded", String(!isHidden));

        if (iconElement) {
          iconElement.setAttribute(
            "data-lucide",
            isHidden ? "chevron-down" : "chevron-up"
          );
          lucide.createIcons({
            nodes: [iconElement],
          });
        }
      }
      
      const bscIconSVG = `<svg class="bsc-icon-bonus" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><g clip-path="url(#clip0_5610_132428)"><path d="M7.37207 11.751L8.01953 10.6709H9.61914L8.19531 12.8076L9.65137 14.999H8.01953L7.34766 13.8711L6.66797 14.999H5.06738L6.52344 12.8232L5.09961 10.6709H6.73145L7.37207 11.751ZM14.292 12.751H15.0039V13.9111H14.292V14.999H12.7959V13.9111H10.0762L9.82812 12.8154L12.7314 9.35938H14.292V12.751ZM11.4521 12.7598H12.7959V11.1436L11.4521 12.7598ZM6.33691 1.06641C9.25713 1.06641 11.6034 3.48064 11.6035 6.43164C11.6035 7.13375 11.4705 7.80634 11.2285 8.42285C11.1585 8.60111 11.0798 8.77514 10.9922 8.94336C10.8391 9.23715 10.4765 9.35130 10.1826 9.19824C9.88877 9.04515 9.77466 8.68253 9.92773 8.38867C9.99581 8.25796 10.0569 8.12292 10.1113 7.98438C10.2993 7.50559 10.4033 6.98168 10.4033 6.43164C10.4032 4.11956 8.57088 2.26660 6.33691 2.26660C4.10309 2.26678 2.27165 4.11967 2.27148 6.43164C2.27157 7.71656 2.83807 8.86268 3.72754 9.62598C3.97903 9.84172 4.00774 10.2212 3.79199 10.4727C3.57625 10.7236 3.19859 10.7525 2.94727 10.5371C1.79931 9.55232 1.0704 8.07674 1.07031 6.43164C1.07048 3.48075 3.41685 1.06658 6.33691 1.06641ZM5.54102 4C6.17511 4 6.55894 4.30508 6.83301 4.64355V4.09863H8.32129V6.94043C8.3214 7.27051 8.46233 7.39453 8.74414 7.39453C8.82242 7.39452 8.909 7.38565 9.00293 7.36914V8.50098C8.81506 8.55877 8.53282 8.63275 8.21191 8.63281C7.60891 8.63281 7.22504 8.40144 7.04492 7.93066C6.73167 8.38492 6.26913 8.66602 5.61914 8.66602C4.53071 8.66589 3.66895 7.78225 3.66895 6.35352V6.33691C3.66903 4.88345 4.53869 4.00003 5.54102 4ZM5.99512 5.30469C5.52539 5.30478 5.12611 5.72588 5.12598 6.32031V6.33691C5.12598 6.93151 5.52531 7.35245 5.99512 7.35254C6.48065 7.35254 6.86426 6.93157 6.86426 6.33691V6.32031C6.86413 5.72581 6.48057 5.30469 5.99512 5.30469Z" fill="currentColor"></path></g><defs><clipPath id="clip0_5610_132428"><rect width="15.9992" height="15.9992" fill="white"></rect></clipPath></defs></svg>`;
      
      function updateUIText() {
        document.querySelectorAll("[data-translate]").forEach((element) => {
          const key = element.getAttribute("data-translate");
          const translationExists =
            translations[currentLanguage] && translations[currentLanguage][key];

          if (translationExists) {
            let translationText = translations[currentLanguage][key];
            
            if (key === 'bscChainToggleLabel') {
                 translationText = currentLanguage === 'km' ? `ជួញដូរលើ BSC ${bscIconSVG} (ពិន្ទុ x 4)` : `Trade on BSC ${bscIconSVG} (Point x 4)`;
                 element.innerHTML = translationText;
            } else if (key === 'notNewTokenToggleLabel') {
                 element.textContent = currentLanguage === 'km' ? 'មិនថ្មី (x1)' : 'Not New (1x)';
            } else if (key === 'otherChainToggleLabel') {
                 element.textContent = currentLanguage === 'km' ? 'បណ្តាញផ្សេងទៀត (x2)' : 'Other Chain (2x)';
            } else if (element.id === "languageToggleButton") {
              const textSpan = element.querySelector("span");
              if (textSpan) {
                textSpan.textContent = translationText;
              }
            } else if (
              element.tagName === "LI" &&
              element.parentElement &&
              element.parentElement.id === "guideList"
            ) {
              if (
                translationText.trim() === "" &&
                (key === "guideStep6")
              ) {
                element.style.display = "none";
              } else {
                element.innerHTML = translationText;
                element.style.display = "";
              }
            } else {
              if (
                element.parentElement &&
                element.parentElement.id === "disclaimerSection" &&
                element.tagName === "P"
              ) {
                element.textContent = translationText;
              } else if (
                element.id !== "disclaimerSection" &&
                (!element.parentElement ||
                  !element.parentElement.classList.contains(
                    "info-badges-container"
                  ))
              ) {
                element.textContent = translationText;
              }
            }
          } else if (
            element.tagName === "LI" &&
            element.parentElement &&
            element.parentElement.id === "guideList" &&
            (key === "guideStep6")
          ) {
            element.style.display = "none";
          }
        });
        
         // Update placeholders
        document.querySelectorAll("[data-translate-placeholder]").forEach(element => {
            const key = element.getAttribute("data-translate-placeholder");
            if (translations[currentLanguage] && translations[currentLanguage][key]) {
                element.placeholder = translations[currentLanguage][key];
            }
        });

      }

      function toggleLanguage() {
        currentLanguage = currentLanguage === "en" ? "km" : "en";
        bodyEl.lang = currentLanguage;
        updateUIText();
        if (!summaryCardEl.classList.contains("hidden")) {
          const summaryData = JSON.parse(
            summaryTextEl.dataset.summaryData || "{}"
          );
          if (
            summaryData.count !== undefined &&
            summaryData.reward !== undefined
          ) {
            summaryTextEl.textContent = translations[
              currentLanguage
            ].summaryClaimedText
              .replace("{count}", summaryData.count)
              .replace("{reward}", summaryData.reward.toFixed(2));
          }
        }

        if (
          volumeCalcResultsEl.style.display === "block" &&
          calculateTradesButtonEl
        ) {
          const lastCalc = JSON.parse(
            volumeCalcResultsEl.dataset.lastCalc || "{}"
          );
          if (lastCalc.targetPoints) {
            tradesNeededResultEl.innerHTML = `<strong class="trades-needed-highlight">${lastCalc.numberOfTrades}</strong> <span class="trades-needed-highlight" data-translate="tradesUnit">${translations[currentLanguage].tradesUnit}</span>`;

            if (lastCalc.isBscTrade) {
                effectiveBscVolumeDisplayVEl.textContent =
                  lastCalc.adjustedTargetUSDVolume.toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                  });
                bscBonusResultItemEl.style.display = "flex";
            } else if (lastCalc.isOtherChainTrade) {
              effectiveOtherChainVolumeDisplayVEl.textContent =
                lastCalc.adjustedTargetUSDVolume.toLocaleString(undefined, {
                  minimumFractionDigits: 2,
                  maximumFractionDigits: 2,
                });
              otherChainBonusResultItemEl.style.display = "flex";
            }
          }
        }
         if (alphaVolumeState.rows.length > 0) {
            reloadAllAlphaVolume(false); // Rerender table with new language without fetching data
        }
      }

      function setDarkModeIcon() {
        darkModeToggle.innerHTML = isDarkMode
          ? '<i data-lucide="sun" class="lucide icon"></i>'
          : '<i data-lucide="moon" class="lucide icon"></i>';
        lucide.createIcons();
      }

      languageToggleButton.addEventListener("click", toggleLanguage);

      simulateButtonEl.addEventListener("click", runSimulation);

      function displayError(messageKey, container = errorMessageContainerEl) {
        const message =
          translations[currentLanguage][messageKey] ||
          "An unknown error occurred.";
        container.innerHTML = `<div class="error-message-style">${message}</div>`;
      }

      function clearError(container = errorMessageContainerEl) {
        container.innerHTML = "";
      }

      function validateInputs(inputs) {
        if (inputs.fixedDailyScore < 0) return "errorNegativeScore";
        if (inputs.totalDays <= 0) return "errorTotalDays";
        if (inputs.rollingWindow <= 0) return "errorRollingWindow";
        if (inputs.rollingWindow > inputs.totalDays)
          return "errorWindowExceedsTotal";
        if (inputs.thresholdScore <= 0) return "errorThresholdScore";
        if (inputs.pointsConsumedPerClaim < 0) return "errorPointsConsumed";
        if (inputs.rewardPerClaim < 0) return "errorRewardPerClaim";
        return null;
      }

      function runSimulation() {
        clearError();
        resultsTableBodyEl.innerHTML = "";
        
        const alphaSimCard = document.getElementById('alphaScoreSimulatorCard');
        
        summaryCardEl.classList.add("hidden");
        resultsCardEl.classList.add("hidden");

        const inputs = {
          fixedDailyScore: parseInt(fixedDailyScoreEl.value) || 0,
          totalDays: parseInt(totalDaysEl.value) || 1,
          rollingWindow: parseInt(rollingWindowEl.value) || 1,
          thresholdScore: parseInt(thresholdScoreEl.value) || 0,
          pointsConsumedPerClaim: parseInt(pointsConsumedEl.value) || 0,
          rewardPerClaim: parseFloat(rewardPerClaimEl.value) || 0,
        };

        const validationErrorKey = validateInputs(inputs);
        if (validationErrorKey) {
          displayError(validationErrorKey);
          return;
        }

        const claimHistory = [];
        let runningTotalReward = 0;
        let runningClaimCount = 0;
        const dailyScoresEarned = Array(inputs.totalDays).fill(
          inputs.fixedDailyScore
        );

        for (let dayIndex = 0; dayIndex < inputs.totalDays; dayIndex++) {
          const currentDayNumber = dayIndex + 1;
          const windowStartDayIndex = Math.max(
            0,
            dayIndex - inputs.rollingWindow + 1
          );
          const windowEndDayIndex = dayIndex;

          let rawScoreInWindow = 0;
          for (let i = windowStartDayIndex; i <= windowEndDayIndex; i++) {
            rawScoreInWindow += dailyScoresEarned[i];
          }

          let pointsConsumedFromRelevantPastClaims = 0;
          claimHistory.forEach((pastClaim) => {
            if (pastClaim.dayIndex >= windowStartDayIndex) {
              pointsConsumedFromRelevantPastClaims += pastClaim.pointsConsumed;
            }
          });

          const scoreForCheck =
            rawScoreInWindow - pointsConsumedFromRelevantPastClaims;

          let claimedToday = false;
          let rewardTodayValue = 0; 
          const consumedForTableDisplay = pointsConsumedFromRelevantPastClaims;

          if (
            scoreForCheck >= inputs.thresholdScore &&
            inputs.pointsConsumedPerClaim >= 0
          ) {
            claimedToday = true;
            rewardTodayValue = inputs.rewardPerClaim;
            runningTotalReward += rewardTodayValue;
            runningClaimCount++;
            claimHistory.push({
              dayIndex: dayIndex,
              pointsConsumed: inputs.pointsConsumedPerClaim,
            });
          }

          const tr = document.createElement("tr");
          tr.innerHTML = `
                                <td class="text-center">${currentDayNumber}</td>
                                <td class="text-center">${
                                  dailyScoresEarned[dayIndex]
                                }</td>
                                <td class="text-center">${scoreForCheck.toFixed(
                                  0
                                )}</td> 
                                <td class="text-center">${
                                  claimedToday ? "✅" : "❌"
                                }</td>
                                <td class="text-center">${consumedForTableDisplay}</td>
                                <td class="text-center">${runningTotalReward.toFixed(
                                  2
                                )}</td> 
                                <td>Day ${
                                  windowStartDayIndex + 1
                                } ~ Day ${currentDayNumber}</td>
                            `;
          resultsTableBodyEl.appendChild(tr);
        }

        summaryTextEl.dataset.summaryData = JSON.stringify({
          count: runningClaimCount,
          reward: runningTotalReward,
        });
        summaryTextEl.textContent = translations[
          currentLanguage
        ].summaryClaimedText
          .replace("{count}", runningClaimCount)
          .replace("{reward}", runningTotalReward.toFixed(2));
        
        alphaSimCard.insertAdjacentElement('afterend', resultsCardEl);
        alphaSimCard.insertAdjacentElement('afterend', summaryCardEl);


        summaryCardEl.classList.remove("hidden");
        resultsCardEl.classList.remove("hidden");
       
        lucide.createIcons();

        if (disclaimerSectionEl) disclaimerSectionEl.classList.remove("hidden");
      }

      function calculateVolumeForPoints(points) {
        if (points <= 0) return 0;
        return 2 * 2 ** (points - 1);
      }

      if (calculateTradesButtonEl) {
        calculateTradesButtonEl.addEventListener("click", () => {
          clearError(volumeCalcErrorMessageContainerEl);
          volumeCalcResultsEl.style.display = "none";
          otherChainBonusResultItemEl.style.display = "none";
          bscBonusResultItemEl.style.display = "none";
          document.getElementById('investmentResultItem').style.display = 'none';

          const initialInvestment = parseFloat(
            initialInvestmentVolCalcEl.value
          );
          const targetPoints = parseInt(targetVolumePointsCalcEl.value);
          const activeBonusButton = document.querySelector('#bonusOptions .bonus-button.active');
          
          let bonusMultiplier = 1;
          if (activeBonusButton) {
              bonusMultiplier = parseInt(activeBonusButton.dataset.multiplier);
          }

          const isOtherChainTrade = bonusMultiplier === 2;
          const isBscTrade = bonusMultiplier === 4;

          if (isNaN(initialInvestment) || initialInvestment <= 0) {
            displayError(
              "errorInitialInvestment",
              volumeCalcErrorMessageContainerEl
            );
            return;
          }
          if (isNaN(targetPoints) || targetPoints <= 0) {
            displayError(
              "errorTargetVolumePoints",
              volumeCalcErrorMessageContainerEl
            );
            return;
          }

          const standardTargetUSDVolume =
            calculateVolumeForPoints(targetPoints);
          let adjustedTargetUSDVolume = standardTargetUSDVolume / bonusMultiplier;

          const numberOfTrades = Math.ceil(
            adjustedTargetUSDVolume / initialInvestment
          );
          const totalAchievedVolume = numberOfTrades * initialInvestment;

          volumeCalcResultsEl.dataset.lastCalc = JSON.stringify({
            targetPoints,
            standardTargetUSDVolume,
            isOtherChainTrade,
            isBscTrade,
            adjustedTargetUSDVolume,
            initialInvestment,
            numberOfTrades,
            totalAchievedVolume,
          });

          targetPointsDisplayVEl.textContent = targetPoints;
          standardVolumeDisplayVEl.textContent =
            standardTargetUSDVolume.toLocaleString(undefined, {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            });
          
          tradesNeededResultEl.innerHTML = `<strong class="trades-needed-highlight">${numberOfTrades}</strong> <span class="trades-needed-highlight" data-translate="tradesUnit">${translations[currentLanguage].tradesUnit}</span>`;
          
          totalAchievedVolumeDisplayVEl.textContent =
            totalAchievedVolume.toLocaleString(undefined, {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            });

          if (isBscTrade) {
             effectiveBscVolumeDisplayVEl.textContent =
              adjustedTargetUSDVolume.toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              });
             bscBonusResultItemEl.style.display = "flex";
          } else if (isOtherChainTrade) {
             effectiveOtherChainVolumeDisplayVEl.textContent =
              adjustedTargetUSDVolume.toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              });
             otherChainBonusResultItemEl.style.display = "flex";
          }
          
          volumeCalcResultsEl.style.display = "block";
          updateUIText();
        });
      }

      /*--- Alpha Volume Script START ---*/
      const alphaVolumeState = {
          rows: [],
          filter: '',
          sortKey: 'vol24h',
          sortDir: 'desc',
          showNewOnly: true,
          boundary: 0
      };

      const av = { // Alpha Volume DOM elements
          tbody: document.querySelector('#tokenTable tbody'),
          refreshBtn: document.getElementById('refreshBtn'),
          progressEl: document.getElementById('progress'),
          lastUpEl: document.getElementById('lastUp'),
          thToday: document.getElementById('thToday'),
          thPrev: document.getElementById('thPrev'),
          toast: document.getElementById('toast'),
          search: document.getElementById('search'),
          onlyNew: document.getElementById('onlyNew')
      };

      const LIST_API='https://www.binance.com/bapi/defi/v1/public/wallet-direct/buw/wallet/cex/alpha/all/token/list';
      const K_API ='https://www.binance.com/bapi/defi/v1/public/alpha-trade/klines';
      const nf0=new Intl.NumberFormat('en-US',{maximumFractionDigits:0});
      const nf2=new Intl.NumberFormat('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
      const FAV_KEY='alphaFavs',CONCURRENCY=5;
      const THIRTY_DAYS = 30*24*60*60*1000;
      
      const fmtShort=ts=>new Intl.DateTimeFormat('en-US', { timeZone:'Asia/Phnom_Penh',hour12:false,month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit' }).format(new Date(ts)).replace(/\//g,'-');
      const fmtFull=ts=>new Intl.DateTimeFormat('en-US', { timeZone:'Asia/Phnom_Penh',hour12:false,year:'numeric',month:'2-digit',day:'2-digit', hour:'2-digit',minute:'2-digit',second:'2-digit' }).format(new Date(ts)).replace(/\//g,'-');
      const nearest8UTC=()=>{ const n=new Date(),b=new Date(); b.setHours(8,0,0,0); if(n<b)b.setDate(b.getDate()-1); return b.getTime(); };

      function showToast(msgKey){
        const msg = translations[currentLanguage][msgKey] || msgKey;
        av.toast.textContent=msg;av.toast.style.opacity='1';
        setTimeout(()=>av.toast.style.opacity='0',3000);
      }
      
      function pLimit(n){
        const q=[];let run=0;
        const next=()=>{if(run>=n||!q.length)return;run++;q.shift()().finally(()=>{run--;next();});};
        return fn=>new Promise(res=>{q.push(()=>fn().then(res));next();});
      }

      const limit=pLimit(CONCURRENCY);

      async function qv(sym,start,end){
        if(start>=end)return 0;
        const url=`${K_API}?symbol=${sym}&interval=1h&startTime=${start}&endTime=${end}&limit=1500`;
        try{
          const {data=[]}=await fetch(url).then(r=>r.json());
          return data.reduce((s,k)=>s+parseFloat(k[7]),0);
        }catch{return 0;}
      }

      async function fillQVAll(list,today8,yest8,endTs){
        let done=0,total=list.length;
        av.progressEl.style.display='inline-block';
        await Promise.all(list.map(r=>limit(async()=>{
          [r.todayQV,r.prevQV]=await Promise.all([
            qv(r.sym,today8,endTs),
            qv(r.sym,yest8,today8-1)
          ]);
          av.progressEl.textContent=`${Math.floor(++done/total*100)}%`;
        })));
        av.progressEl.style.display='none';
      }
      const favs=()=>JSON.parse(localStorage.getItem(FAV_KEY)||'[]');
      function toggleFav(sym){
        const f=favs();const i=f.indexOf(sym);
        i>-1?f.splice(i,1):f.push(sym);
        localStorage.setItem(FAV_KEY,JSON.stringify(f));
        showToast(i>-1?'toastFavRemoved':'toastFavAdded');
        renderAlphaVolume();
      }

      async function fetchList(){
        const resp=await fetch(LIST_API);
        if(!resp.ok)throw new Error('LIST_API Error');
        const {data=[]}=await resp.json();
        return data
          .filter(t=>+t.volume24h>0)
          .map(t=>{
            const raw = Number(t.listingTime || 0);
            const ltMs = raw ? (raw < 1e12 ? raw*1000 : raw) : 0;
            const isNew = ltMs ? (Date.now() - ltMs) <= THIRTY_DAYS : false;
            return {
              price:+t.price, vol24h:+t.volume24h, chg:+t.percentChange24h,
              symbol:t.symbol, icon:t.iconUrl, sym:`${t.alphaId}USDT`,
              todayQV:0, prevQV:0, listingTime: ltMs,
              listingTimeFmt: ltMs ? fmtFull(ltMs) : '', isNew
            };
          });
      }

      function sortRows(arr){
        const { sortKey, sortDir } = alphaVolumeState;
        return [...arr].sort((a,b)=>sortDir==='desc'?b[sortKey]-a[sortKey]:a[sortKey]-b[sortKey]);
      }
      function updateSortIcons(){
        document.querySelectorAll('#alphaVolumeCard th.sortable').forEach(th=>{
          th.classList.remove('asc','desc');
          if(th.dataset.key===alphaVolumeState.sortKey)th.classList.add(alphaVolumeState.sortDir);
        });
      }

      function renderAlphaVolume(){
        const { rows, filter, showNewOnly } = alphaVolumeState;
        const favSet=new Set(favs());
        const filtered=rows.filter(r=>{
          const matched = r.symbol.toLowerCase().includes(filter)||r.sym.toLowerCase().includes(filter);
          const newOk = !showNewOnly || r.isNew;
          return matched && newOk;
        });
        const sorted=sortRows(filtered);
        const display=[...sorted.filter(x=>favSet.has(x.sym)),...sorted.filter(x=>!favSet.has(x.sym))];

        if (display.length === 0) {
            av.tbody.innerHTML = `<tr><td colspan="8">${translations[currentLanguage].loadingText}</td></tr>`;
            return;
        }
        
        const newIconSVG = `<svg class="new-token-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><g clip-path="url(#clip0_5610_132428)"><path d="M7.37207 11.751L8.01953 10.6709H9.61914L8.19531 12.8076L9.65137 14.999H8.01953L7.34766 13.8711L6.66797 14.999H5.06738L6.52344 12.8232L5.09961 10.6709H6.73145L7.37207 11.751ZM14.292 12.751H15.0039V13.9111H14.292V14.999H12.7959V13.9111H10.0762L9.82812 12.8154L12.7314 9.35938H14.292V12.751ZM11.4521 12.7598H12.7959V11.1436L11.4521 12.7598ZM6.33691 1.06641C9.25713 1.06641 11.6034 3.48064 11.6035 6.43164C11.6035 7.13375 11.4705 7.80634 11.2285 8.42285C11.1585 8.60111 11.0798 8.77514 10.9922 8.94336C10.8391 9.23715 10.4765 9.35130 10.1826 9.19824C9.88877 9.04515 9.77466 8.68253 9.92773 8.38867C9.99581 8.25796 10.0569 8.12292 10.1113 7.98438C10.2993 7.50559 10.4033 6.98168 10.4033 6.43164C10.4032 4.11956 8.57088 2.26660 6.33691 2.26660C4.10309 2.26678 2.27165 4.11967 2.27148 6.43164C2.27157 7.71656 2.83807 8.86268 3.72754 9.62598C3.97903 9.84172 4.00774 10.2212 3.79199 10.4727C3.57625 10.7236 3.19859 10.7525 2.94727 10.5371C1.79931 9.55232 1.0704 8.07674 1.07031 6.43164C1.07048 3.48075 3.41685 1.06658 6.33691 1.06641ZM5.54102 4C6.17511 4 6.55894 4.30508 6.83301 4.64355V4.09863H8.32129V6.94043C8.3214 7.27051 8.46233 7.39453 8.74414 7.39453C8.82242 7.39452 8.909 7.38565 9.00293 7.36914V8.50098C8.81506 8.55877 8.53282 8.63275 8.21191 8.63281C7.60891 8.63281 7.22504 8.40144 7.04492 7.93066C6.73167 8.38492 6.26913 8.66602 5.61914 8.66602C4.53071 8.66589 3.66895 7.78225 3.66895 6.35352V6.33691C3.66903 4.88345 4.53869 4.00003 5.54102 4ZM5.99512 5.30469C5.52539 5.30478 5.12611 5.72588 5.12598 6.32031V6.33691C5.12598 6.93151 5.52531 7.35245 5.99512 7.35254C6.48065 7.35254 6.86426 6.93157 6.86426 6.33691V6.32031C6.86413 5.72581 6.48057 5.30469 5.99512 5.30469Z" fill="currentColor"></path></g><defs><clipPath id="clip0_5610_132428"><rect width="15.9992" height="15.9992" fill="white"></rect></clipPath></defs></svg>`;

        av.tbody.innerHTML=display.map((t,i)=>`
          <tr data-sym="${t.sym}">
            <td class="star ${favSet.has(t.sym)?'fav':''}">${favSet.has(t.sym)?'★':'☆'}</td>
            <td>${i+1}</td>
            <td title="${t.listingTimeFmt ? ('${translations[currentLanguage].tableHeaderToken}：'+t.listingTimeFmt) : ''}">
              <img class="logo" loading="lazy" src="${t.icon}" referrerpolicy="no-referrer" onerror="this.src='https://bin.bnbstatic.com/static/images/common/base-token-default.png'">
              ${t.symbol}
              ${t.isNew ? `<span title="New: ${t.listingTimeFmt}">${newIconSVG}</span>` : ''}
            </td>
            <td>${nf2.format(t.price)}</td>
            <td>${nf0.format(t.vol24h)}</td>
            <td class="${t.chg>=0?'up':'down'}">${t.chg.toFixed(2)}%</td>
            <td>${t.todayQV?nf0.format(t.todayQV):'…'}</td>
            <td>${t.prevQV?nf0.format(t.prevQV):'…'}</td>
          </tr>
        `).join('');
        updateSortIcons();
      }

      async function reloadAllAlphaVolume(fetchData = true){
        const refreshIcon = document.getElementById('refreshIcon');
        if (refreshIcon) refreshIcon.classList.add('spinning');
        
        av.refreshBtn.disabled=true;
        av.progressEl.textContent='0%';
        const today8=nearest8UTC(),yest8=today8-864e5,endTs=Date.now();

        const todayText = translations[currentLanguage].tableHeaderTodayVol;
        const prevText = translations[currentLanguage].tableHeaderPrevVol;
        av.thToday.innerHTML=`${todayText}<span class="subl">(${fmtShort(today8)}&nbsp;~&nbsp;${fmtShort(endTs)})</span>`;
        av.thPrev.innerHTML =`${prevText}<span class="subl">(${fmtShort(yest8)}&nbsp;~&nbsp;${fmtShort(today8-1)})</span>`;

        try{
          if (fetchData) {
            alphaVolumeState.rows=await fetchList();
            await fillQVAll(alphaVolumeState.rows,today8,yest8,endTs);
          }
          renderAlphaVolume();
          const time = fmtFull(Date.now());
          av.lastUpEl.textContent = translations[currentLanguage].lastUpdated.replace('{time}', time);
          alphaVolumeState.boundary = today8;
        }catch(e){
          console.error(e);
          av.tbody.innerHTML=`<tr><td colspan="8">${translations[currentLanguage].loadFailedText}</td></tr>`;
          showToast('loadFailedText');
        }finally{
          if (refreshIcon) refreshIcon.classList.remove('spinning');
          av.refreshBtn.disabled=false;
        }
      }

      function functionToRunOnDOMLoad() {
         /* --- Alpha Volume Listeners --- */
        av.search.addEventListener('input',e=>{
          alphaVolumeState.filter=e.target.value.trim().toLowerCase();renderAlphaVolume();
        });
        av.tbody.addEventListener('click',e=>{
          const s=e.target.closest('.star');
          if(s){s.classList.add('bounce');setTimeout(()=>s.classList.remove('bounce'),150);toggleFav(s.closest('tr').dataset.sym);}
        });
        document.querySelectorAll('#alphaVolumeCard th.sortable').forEach(th=>{
          th.addEventListener('click',()=>{
            const key=th.dataset.key;
            alphaVolumeState.sortDir=(alphaVolumeState.sortKey===key&&alphaVolumeState.sortDir==='desc')?'asc':'desc';alphaVolumeState.sortKey=key;renderAlphaVolume();
          });
        });
        av.onlyNew.addEventListener('change', (e)=>{
          alphaVolumeState.showNewOnly = e.target.checked;
          renderAlphaVolume();
        });
        av.refreshBtn.addEventListener('click', () => reloadAllAlphaVolume(true));
        
        reloadAllAlphaVolume(true);
      }
      /*--- Alpha Volume Script END ---*/


      document.addEventListener("DOMContentLoaded", () => {
        bodyEl.lang = currentLanguage;

        // --- START THEME LOGIC ---
        function applyTheme(isDark) {
            isDarkMode = isDark;
            bodyEl.classList.toggle("dark-mode", isDarkMode);
            setDarkModeIcon();
        }

        // Check for system preference for dark mode
        const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");

        // Set initial theme based on system preference
        applyTheme(prefersDarkScheme.matches);
        
        // Listen for changes in system preference to auto-update the theme
        prefersDarkScheme.addEventListener("change", (e) => {
            applyTheme(e.matches);
        });
        
        // Manual toggle overrides system preference for the session
        darkModeToggle.addEventListener("click", () => applyTheme(!isDarkMode));
        // --- END THEME LOGIC ---

        if(av.onlyNew) {
            av.onlyNew.checked = true;
        }

        const bonusOptionsContainer = document.getElementById('bonusOptions');
        if (bonusOptionsContainer) {
            const bonusButtons = bonusOptionsContainer.querySelectorAll('.bonus-button');
            bonusButtons.forEach(button => {
                button.addEventListener('click', () => {
                    bonusButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                });
            });
        }


        document.querySelectorAll(".neobrutalist-card").forEach((card) => {
          const header = card.querySelector(".card-header");
          const toggleButton = header
            ? header.querySelector(".card-toggle-button")
            : null;
          const contentId = header ? header.dataset.collapsibleTarget : null;
          const cardId = card.id;

          if (header && toggleButton && contentId) {
            header.addEventListener("click", function (event) {
              if (
                event.target === toggleButton ||
                toggleButton.contains(event.target) ||
                ((event.target === header || header.contains(event.target)) &&
                  !event.target.closest(
                    "button:not(.card-toggle-button), a, input, select, textarea"
                  ))
              ) {
                toggleCardContent(toggleButton);
              }
            });

            const contentElement = document.getElementById(contentId);
            const iconElement =
              toggleButton.querySelector("i.card-toggle-icon");

            if (contentElement && iconElement) {
              let isInitiallyOpen =
                cardId === "alphaScoreSimulatorCard" ||
                cardId === "alphaVolumeCard";
              
              if(cardId === "volumeCalcCard"){
                  isInitiallyOpen = false;
              }
              if(cardId === "alphaVolumeCard"){
                  isInitiallyOpen = true;
              }

              if (cardId === "summaryCard" || cardId === "resultsCard") {
                if (card) card.classList.add("hidden");
                contentElement.classList.add("hidden");
                toggleButton.setAttribute("aria-expanded", "false");
                iconElement.setAttribute("data-lucide", "chevron-down");
              } else if (isInitiallyOpen) {
                contentElement.classList.remove("hidden");
                toggleButton.setAttribute("aria-expanded", "true");
                iconElement.setAttribute("data-lucide", "chevron-up");
              } else {
                contentElement.classList.add("hidden");
                toggleButton.setAttribute("aria-expanded", "false");
                iconElement.setAttribute("data-lucide", "chevron-down");
              }
            }
          }
        });
        
        functionToRunOnDOMLoad();
        lucide.createIcons();
        updateUIText();
        if (disclaimerSectionEl) disclaimerSectionEl.classList.remove("hidden");

      });
    </script>
  </body>
</html>

